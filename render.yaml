# render.yaml
# Converto Business OS â€” Landing / Coming Soon
# Tuotanto + Staging -ympÃ¤ristÃ¶t, valmiina Render Blueprint deploylle

services:
  # ==========================
  # ðŸŸ¢ PRODUCTION SERVICE
  # ==========================
  - type: web
    name: converto-dashboard
    env: node
    region: frankfurt
    plan: starter
    branch: main
    autoDeploy: true
    buildCommand: npm install && npm run build --workspace=@converto/dashboard
    startCommand: npm run start --workspace=@converto/dashboard
    healthCheckPath: /api/health

    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_RUNTIME
        value: nodejs

      # SUPABASE
      - key: NEXT_PUBLIC_SUPABASE_URL
        value: "https://your-project.supabase.co"
        sync: false
      - key: SUPABASE_SERVICE_ROLE
        sync: false

      # RESEND
      - key: RESEND_API_KEY
        sync: false
      - key: FROM_EMAIL
        value: "no-reply@converto.fi"

      # I18N
      - key: NEXT_PUBLIC_I18N_ENABLED
        value: "true"

      # SITE + THEME
      - key: SITE_URL
        value: "https://converto.fi"
      - key: NEXT_PUBLIC_THEME
        value: "emerald"

      # ANALYTICS
      - key: NEXT_PUBLIC_PLAUSIBLE_DOMAIN
        value: "converto.fi"

      # SENTRY (optional)
      - key: SENTRY_DSN
        value: ""
      - key: SENTRY_ENVIRONMENT
        value: production

      # RATE LIMITS
      - key: RATE_LIMIT_MAX
        value: "10"
      - key: RATE_LIMIT_WINDOW
        value: "60000"

      # PWA
      - key: NEXT_PUBLIC_PWA_ENABLED
        value: "true"
      - key: NEXT_PUBLIC_PWA_NAME
        value: "Converto Business OS"
      - key: NEXT_PUBLIC_PWA_THEME_COLOR
        value: "#10B981"

      # SECURITY
      - key: ALLOWED_ORIGINS
        value: "https://converto.fi,https://app.converto.fi"
      - key: TRUST_PROXY_HEADERS
        value: "true"

      # HEALTHCHECK
      - key: ENABLE_HEALTHCHECK
        value: "true"

    routes:
      - type: rewrite
        source: "/"
        destination: "/coming-soon"

  # ==========================
  # ðŸ§ª STAGING SERVICE
  # ==========================
  - type: web
    name: converto-staging
    env: node
    region: frankfurt
    plan: starter
    branch: dev
    autoDeploy: true
    healthCheckPath: /api/health
    buildCommand: npm install && npm run build --workspace=@converto/dashboard
    startCommand: npm run start --workspace=@converto/dashboard

    envVars:
      - key: NODE_ENV
        value: staging
      - key: NEXT_RUNTIME
        value: nodejs

      # SUPABASE (voit kÃ¤yttÃ¤Ã¤ samaa projektia tai erillistÃ¤ stagingia)
      - key: NEXT_PUBLIC_SUPABASE_URL
        value: "https://your-project.supabase.co"
        sync: false
      - key: SUPABASE_SERVICE_ROLE
        sync: false

      # RESEND
      - key: RESEND_API_KEY
        sync: false
      - key: FROM_EMAIL
        value: "no-reply@staging.converto.fi"

      # I18N
      - key: NEXT_PUBLIC_I18N_ENABLED
        value: "true"

      # SITE + THEME
      - key: SITE_URL
        value: "https://staging.converto.fi"
      - key: NEXT_PUBLIC_THEME
        value: "emerald"

      # ANALYTICS
      - key: NEXT_PUBLIC_PLAUSIBLE_DOMAIN
        value: "staging.converto.fi"

      # SENTRY
      - key: SENTRY_DSN
        value: ""
      - key: SENTRY_ENVIRONMENT
        value: staging

      # RATE LIMITS
      - key: RATE_LIMIT_MAX
        value: "5"
      - key: RATE_LIMIT_WINDOW
        value: "60000"

      # PWA
      - key: NEXT_PUBLIC_PWA_ENABLED
        value: "true"
      - key: NEXT_PUBLIC_PWA_NAME
        value: "Converto Staging"
      - key: NEXT_PUBLIC_PWA_THEME_COLOR
        value: "#22C55E"

      # SECURITY
      - key: ALLOWED_ORIGINS
        value: "https://staging.converto.fi"
      - key: TRUST_PROXY_HEADERS
        value: "true"

      # HEALTHCHECK
      - key: ENABLE_HEALTHCHECK
        value: "true"

    routes:
      - type: rewrite
        source: "/"
        destination: "/coming-soon"

# ==========================
# ðŸ“Š DAILY PILOT REPORT CRON
# ==========================
jobs:
  - name: daily-pilot-report
    type: cron
    schedule: "0 8 * * *"        # joka pÃ¤ivÃ¤ klo 08:00 UTC (= 10:00 Suomen aikaa)
    env: node
    plan: starter
    serviceName: converto-dashboard
    command: curl -fsSL https://converto.fi/api/pilot-report
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_SUPABASE_URL
        value: "https://your-project.supabase.co"
        sync: false
      - key: SUPABASE_SERVICE_ROLE
        sync: false
      - key: RESEND_API_KEY
        sync: false
      - key: FROM_EMAIL
        value: "no-reply@converto.fi"
      - key: REPORT_EMAILS
        value: "ops@converto.fi,founder@converto.fi"
